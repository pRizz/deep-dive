---
phase: 01-platform-ci-baseline
plan: 04
type: execute
wave: 2
depends_on:
  - "01-02"
files_modified:
  - package.json
  - .changeset/config.json
  - scripts/sync-version.mjs
  - scripts/semantic-release-version.cjs
  - .releaserc.cjs
  - .github/workflows/release.yml
  - metadata.json
autonomous: true
must_haves:
  truths:
    - "Maintainer can run a release workflow that updates versions and creates tags."
    - "Changesets drives version/changelog updates in a version PR."
    - "Semantic-release creates GitHub releases from the versioned files."
  artifacts:
    - path: ".changeset/config.json"
      provides: "Changesets configuration for version PRs"
    - path: ".github/workflows/release.yml"
      provides: "Release workflow using Changesets + semantic-release"
    - path: ".releaserc.cjs"
      provides: "Semantic-release configuration that reads file versions"
  key_links:
    - from: ".github/workflows/release.yml"
      to: ".changeset/config.json"
      via: "changesets/action version PR"
      pattern: "changesets/action@v1"
    - from: ".releaserc.cjs"
      to: "ui/package.json"
      via: "custom version reader script"
      pattern: "semantic-release-version.cjs"
---

<objective>
Add release automation with Changesets + semantic-release.

Purpose: Satisfy PLAT-02 by providing automated version PRs and tagged releases.
Output: Changesets config, semantic-release config, and a release workflow.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-platform-ci-baseline/01-RESEARCH.md
@ui/package.json
@metadata.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Changesets + version sync</name>
  <files>package.json, .changeset/config.json, scripts/sync-version.mjs, metadata.json</files>
  <action>
    - Add a root `package.json` (private) with workspaces for `ui/`, and install devDependencies for `@changesets/cli` and semantic-release plugins.
    - Create `.changeset/config.json` with `baseBranch: "main"` and default changelog behavior; add scripts `changeset`, `version`, and `release` to the root package.
    - Add `scripts/sync-version.mjs` that copies the version from `ui/package.json` into `metadata.json` (add a top-level `version` field if missing).
    - Wire `npm run version` to run `changeset version` followed by `node scripts/sync-version.mjs` so the version PR captures both files.
  </action>
  <verify>npm run version</verify>
  <done>Changeset versioning updates `ui/package.json` and keeps `metadata.json` in sync.</done>
</task>

<task type="auto">
  <name>Task 2: Add semantic-release config and release workflow</name>
  <files>.releaserc.cjs, scripts/semantic-release-version.cjs, .github/workflows/release.yml</files>
  <action>
    - Create `scripts/semantic-release-version.cjs` custom plugin that reads `ui/package.json` and sets `nextRelease.version` when it differs from the latest git tag.
    - Configure `.releaserc.cjs` to use the custom plugin plus `@semantic-release/github` and tag format `v${version}` (no commit analysis to avoid conflicting version sources).
    - Add `.github/workflows/release.yml` triggered on `workflow_dispatch` and push to `main` that runs `changesets/action@v1` to open a version PR and, on merge, runs `npm run release` (semantic-release) to tag and create GitHub releases.
  </action>
  <verify>GitHub Actions release workflow runs with no configuration errors.</verify>
  <done>Release workflow creates version PRs and tags/releases matching `ui/package.json`.</done>
</task>

</tasks>

<verification>
- `npm run version` updates versions and metadata in a single commit.
- Release workflow can create a version PR and then tag a release after merge.
</verification>

<success_criteria>
- Automated version PRs exist via Changesets.
- Semantic-release creates tags/releases based on versioned files.
</success_criteria>

<output>
After completion, create `.planning/phases/01-platform-ci-baseline/01-04-SUMMARY.md`
</output>
