---
phase: 08-dedupe-image-list-by-hash-and-show-aliases
plan: 01
type: execute
wave: 1
depends_on: ["07-01"]
files_modified:
  - ui/src/App.tsx
  - ui/src/models.ts
autonomous: true
must_haves:
  truths:
    - "Images list is deduped by image hash (ID) so each image appears once."
    - "Image cards display the primary image name and its aliases."
    - "Filtering and sorting continue to work with the deduped list."
  artifacts:
    - path: "ui/src/App.tsx"
      provides: "Deduped image list and alias rendering in cards"
    - path: "ui/src/models.ts"
      provides: "Image model supports aliases"
  key_links:
    - from: "ui/src/App.tsx"
      to: "ui/src/models.ts"
      via: "Image interface additions"
      pattern: "aliases"
---

<objective>
Dedupe the main image list by image hash and show aliases for each image in the UI cards.

Purpose: Avoid showing duplicate entries for the same image when it has both tag and digest references, while still surfacing all known aliases to the user.
Output: One card per image hash with a clear list of aliases, preserving filtering and sorting.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@ui/src/App.tsx
@ui/src/models.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Deduplicate images by hash and track aliases</name>
  <files>ui/src/App.tsx, ui/src/models.ts</files>
  <action>
    - Extend the `Image` model to include an `aliases` field (string array) and a distinct `primaryName` or reuse `name` as the primary alias.
    - Update `getImages` to group Docker images by `i.Id` (full hash).
    - Build a unique alias list per image from RepoTags and RepoDigests (filtering out `<none>` entries).
    - Choose a primary display name with a stable rule (prefer tag, otherwise digest) and keep `name`/`primaryName` aligned to that rule.
    - Ensure `createdAt`, `sizeBytes`, `id`, and `fullId` are retained for the deduped image entry.
  </action>
  <verify>
    - Read `getImages` to confirm it returns one Image per hash with aliases.
    - Confirm Image model includes alias support.
  </verify>
  <done>Image list is deduped by hash and each entry includes aliases.</done>
</task>

<task type="auto">
  <name>Task 2: Show aliases in image cards and keep filtering/sorting sane</name>
  <files>ui/src/App.tsx</files>
  <action>
    - Update `ImageCard` to display aliases under the primary image name (comma-separated text or chips).
    - Make filtering match both primary name and aliases so users can find images via any reference.
    - Keep sorting based on the primary name/created time/size fields as before.
    - Confirm analyze action uses the primary alias (or a chosen alias) to avoid regressions.
  </action>
  <verify>
    - Check the card rendering to confirm aliases are shown for images with multiple references.
    - Verify the filter matches alias text.
  </verify>
  <done>Image cards list aliases and the filter works with aliases.</done>
</task>

</tasks>

<verification>
- Image list shows only one entry per image hash.
- Each image card displays aliases when available.
- Filtering works with both primary name and aliases.
</verification>

<success_criteria>
- Duplicate tag/digest entries are collapsed into a single image card.
- Alias list preserves all references for that image hash.
- User can still analyze images without changing their workflow.
</success_criteria>

<output>
After completion, create `.planning/phases/08-dedupe-image-list-by-hash-and-show-aliases/08-01-SUMMARY.md`
</output>
